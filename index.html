<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Strona Trenera Jaguara</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: #f5f7fa;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    nav button {
      margin-right: 10px;
      padding: 10px 15px;
      border: none;
      background-color: #2980b9;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    nav button:hover {
      background-color: #3498db;
    }
    .tab {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-top: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    .active {
      display: block;
    }
    .box {
      border: 1px solid #ccc;
      padding: 15px;
      margin: 10px 0;
      border-radius: 7px;
      background: #ecf0f1;
    }
    input, textarea, select, button {
      margin: 8px 0;
      display: block;
      width: 100%;
      max-width: 400px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button[type="submit"] {
      background-color: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    button[type="submit"]:hover {
      background-color: #2ecc71;
    }
    label {
      font-weight: 600;
      margin-top: 12px;
    }
    #chartContainer {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 20px;
      gap: 30px;
    }
    canvas {
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    /* Scroll for long lists */
    #matchList, #teamList {
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>üìã Strona Trenera Jaguara</h1>

  <nav>
    <button onclick="showTab('matches')">1Ô∏è‚É£ Analiza Mecz√≥w</button>
    <button onclick="showTab('teams')">2Ô∏è‚É£ Dru≈ºyny i Zawodnicy</button>
    <button onclick="showTab('stats')">3Ô∏è‚É£ Statystyki Zawodnika</button>
  </nav>

  <!-- Analiza Mecz√≥w -->
  <div id="matches" class="tab active">
    <h2>Analiza Mecz√≥w</h2>
    <form id="matchForm">
      <input type="date" id="matchDate" required />
      <input type="text" id="opponents" placeholder="Przeciwnicy (np. Jaguar vs XYZ)" required />
      <input type="text" id="score" placeholder="Wynik (np. 3:1)" required />
      <select id="matchRating" required>
        <option value="">Ocena meczu (1‚Äì5)</option>
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      </select>
      <input type="text" id="scorers" placeholder="Kto strzeli≈Ç gole?" />
      <input type="text" id="bestPlayer" placeholder="Najlepszy gracz meczu" />
      <input type="text" id="top3Jaguar" placeholder="Top 3 Jaguar (np. Janek, Marek, Kuba)" />
      <input type="text" id="top3Opponents" placeholder="Top 3 przeciwnika" />
      <textarea id="matchDescription" placeholder="Opis meczu (opcjonalny)"></textarea>
      <button type="submit">Zapisz mecz</button>
    </form>
    <div id="matchList"></div>
  </div>

  <!-- Dru≈ºyny i Zawodnicy -->
  <div id="teams" class="tab">
    <h2>Dru≈ºyny i Zawodnicy</h2>
    <form id="teamForm">
      <input type="text" id="teamName" placeholder="Nazwa dru≈ºyny" required />
      <button type="submit">Dodaj dru≈ºynƒô</button>
    </form>
    <div id="teamList"></div>
  </div>

  <!-- Statystyki Zawodnika -->
  <div id="stats" class="tab">
    <h2>Statystyki Zawodnika</h2>
    
    <label for="teamSelect">Wybierz dru≈ºynƒô:</label>
    <select id="teamSelect">
      <option value="">-- wybierz dru≈ºynƒô --</option>
    </select>

    <label for="playerSelect">Wybierz zawodnika:</label>
    <select id="playerSelect" disabled>
      <option value="">-- wybierz zawodnika --</option>
    </select>

    <form id="ratingForm" style="margin-top: 20px;">
      <input type="date" id="ratingDate" required />
      <select id="ratingType" required>
        <option value="">Typ oceny</option>
        <option value="mecz">Po meczu</option>
        <option value="trening">Po treningu</option>
      </select>
      <input type="number" id="ratingValue" placeholder="Ocena 1‚Äì5" min="1" max="5" required />
      <input type="number" id="minutesPlayed" placeholder="Minuty (je≈õli mecz)" />
      <button type="submit">Dodaj ocenƒô</button>
    </form>

    <div id="ratingOutput" style="margin-top: 15px; font-weight: 600;"></div>

    <div id="chartContainer">
      <div>
        <h3>Oceny po meczu</h3>
        <canvas id="matchChart" width="600" height="300"></canvas>
      </div>
      <div>
        <h3>Oceny po treningu</h3>
        <canvas id="trainingChart" width="600" height="300"></canvas>
      </div>
    </div>
  </div>

<script>
  // POKAZYWANIE ZAK≈ÅADEK
  function showTab(id) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'))
    document.getElementById(id).classList.add('active')
  }

  // --- ANALIZA MECZ√ìW ---
  const matchForm = document.getElementById('matchForm')
  const matchList = document.getElementById('matchList')

  matchForm.onsubmit = function (e) {
    e.preventDefault()
    const match = {
      date: matchDate.value,
      opponents: opponents.value,
      score: score.value,
      rating: matchRating.value,
      scorers: scorers.value,
      bestPlayer: bestPlayer.value,
      top3Jaguar: top3Jaguar.value,
      top3Opponents: top3Opponents.value,
      description: matchDescription.value
    }
    const matches = JSON.parse(localStorage.getItem('matches') || '[]')
    matches.push(match)
    localStorage.setItem('matches', JSON.stringify(matches))
    renderMatches()
    matchForm.reset()
  }

  function renderMatches() {
    const matches = JSON.parse(localStorage.getItem('matches') || '[]')
    matchList.innerHTML = ''
    matches.forEach(m => {
      const div = document.createElement('div')
      div.className = 'box'
      div.innerHTML = `
        <strong>${m.date}</strong> ‚Äì ${m.opponents} (${m.score})<br>
        Ocena: ${m.rating}/5<br>
        Strzelcy: ${m.scorers}<br>
        MVP: ${m.bestPlayer}<br>
        Top 3 Jaguar: ${m.top3Jaguar}<br>
        Top 3 Przeciwnik: ${m.top3Opponents}<br>
        Opis: ${m.description || '-'}
      `
      matchList.appendChild(div)
    })
  }

  renderMatches()

  // --- DRU≈ªYNY I ZAWODNICY ---
  const teamForm = document.getElementById('teamForm')
  const teamList = document.getElementById('teamList')
  const teamSelect = document.getElementById('teamSelect')
  const playerSelect = document.getElementById('playerSelect')

  teamForm.onsubmit = function (e) {
    e.preventDefault()
    const name = teamName.value.trim()
    if(!name) return
    const teams = JSON.parse(localStorage.getItem('teams') || '[]')
    if(teams.some(t => t.name.toLowerCase() === name.toLowerCase())) {
      alert('Taka dru≈ºyna ju≈º istnieje!')
      return
    }
    teams.push({ name, players: [] })
    localStorage.setItem('teams', JSON.stringify(teams))
    teamForm.reset()
    renderTeams()
    renderTeamSelect()
  }

  function renderTeams() {
    const teams = JSON.parse(localStorage.getItem('teams') || '[]')
    teamList.innerHTML = ''
    teams.forEach((t, i) => {
      const div = document.createElement('div')
      div.className = 'box'
      div.innerHTML = `
        <strong>${t.name}</strong><br>
        <input type="text" id="p-${i}" placeholder="Dodaj zawodnika" />
        <button onclick="addPlayer(${i})" style="margin-top: 5px; max-width: 120px;">Dodaj</button>
        <ul id="players-${i}"></ul>
      `
      teamList.appendChild(div)

      const playerList = document.getElementById(`players-${i}`)
      playerList.innerHTML = ''
      t.players.forEach(p => {
        const li = document.createElement('li')
        li.textContent = p
        playerList.appendChild(li)
      })
    })
  }

  function addPlayer(teamIndex) {
    const teams = JSON.parse(localStorage.getItem('teams') || '[]')
    const input = document.getElementById(`p-${teamIndex}`)
    const name = input.value.trim()
    if (!name) return alert("Wpisz nazwƒô zawodnika")
    // Sprawd≈∫ czy zawodnik ju≈º istnieje w dru≈ºynie
    if(teams[teamIndex].players.some(p => p.toLowerCase() === name.toLowerCase())) {
      alert("Taki zawodnik ju≈º jest w dru≈ºynie")
      return
    }
    teams[teamIndex].players.push(name)
    localStorage.setItem('teams', JSON.stringify(teams))
    input.value = ''
    renderTeams()
    renderTeamSelect()
  }

  function renderTeamSelect() {
    const teams = JSON.parse(localStorage.getItem('teams') || '[]')
    teamSelect.innerHTML = '<option value="">-- wybierz dru≈ºynƒô --</option>'
    teams.forEach(t => {
      const option = document.createElement('option')
      option.value = t.name
      option.text = t.name
      teamSelect.appendChild(option)
    })
    playerSelect.innerHTML = '<option value="">-- wybierz zawodnika --</option>'
    playerSelect.disabled = true
  }

  teamSelect.addEventListener('change', () => {
    const selectedTeam = teamSelect.value
    playerSelect.innerHTML = '<option value="">-- wybierz zawodnika --</option>'
    if(!selectedTeam) {
      playerSelect.disabled = true
      return
    }
    const teams = JSON.parse(localStorage.getItem('teams') || '[]')
    const team = teams.find(t => t.name === selectedTeam)
    if(team) {
      team.players.forEach(p => {
        const option = document.createElement('option')
        option.value = p
        option.text = p
        playerSelect.appendChild(option)
      })
      playerSelect.disabled = false
    } else {
      playerSelect.disabled = true
    }
    clearStatsAndCharts()
  })

  // --- STATYSTYKI ZAWODNIKA ---
  const ratingForm = document.getElementById('ratingForm')
  const ratingOutput = document.getElementById('ratingOutput')
  const matchChart = document.getElementById('matchChart').getContext('2d')
  const trainingChart = document.getElementById('trainingChart').getContext('2d')

  // Dane do wykres√≥w
  let ratingsData = {}

  ratingForm.onsubmit = function(e) {
    e.preventDefault()
    const player = playerSelect.value
    if (!player) {
      alert("Wybierz zawodnika")
      return
    }
    const data = {
      date: ratingDate.value,
      type: ratingType.value,
      rating: Number(ratingValue.value),
      minutes: Number(minutesPlayed.value) || 0
    }
    if (!data.date || !data.type || !data.rating) {
      alert("Wype≈Çnij wszystkie wymagane pola")
      return
    }

    const all = JSON.parse(localStorage.getItem('ratings') || '{}')
    if (!all[player]) all[player] = []
    all[player].push(data)
    localStorage.setItem('ratings', JSON.stringify(all))

    ratingForm.reset()
    showStats(player)
    drawCharts(player)
  }

  playerSelect.addEventListener('change', () => {
    const player = playerSelect.value
    if(player) {
      showStats(player)
      drawCharts(player)
    } else {
      clearStatsAndCharts()
    }
  })

  function showStats(player) {
    const all = JSON.parse(localStorage.getItem('ratings') || '{}')
    const data = all[player] || []
    if(data.length === 0) {
      ratingOutput.textContent = `Brak ocen dla ${player}`
      return
    }
    const avgAll = (arr) => arr.reduce((a,b) => a + b.rating, 0) / arr.length
    const matchRatings = data.filter(d => d.type === 'mecz')
    const trainingRatings = data.filter(d => d.type === 'trening')
    const avgMatch = matchRatings.length ? avgAll(matchRatings).toFixed(2) : '-'
    const avgTraining = trainingRatings.length ? avgAll(trainingRatings).toFixed(2) : '-'

    ratingOutput.innerHTML = `
      ≈örednia ocena po meczu: <strong>${avgMatch}</strong><br>
      ≈örednia ocena po treningu: <strong>${avgTraining}</strong>
    `
  }

  function clearStatsAndCharts() {
    ratingOutput.textContent = ''
    clearCanvas(matchChart)
    clearCanvas(trainingChart)
  }

  function clearCanvas(ctx) {
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
  }

  // Funkcja do rysowania wykres√≥w
  function drawCharts(player) {
    const all = JSON.parse(localStorage.getItem('ratings') || '{}')
    const data = all[player] || []
    if(data.length === 0) {
      clearStatsAndCharts()
      return
    }

    // Sortowanie po dacie
    const parseDate = d => new Date(d.date)
    const matchRatings = data.filter(d => d.type === 'mecz').sort((a,b) => parseDate(a) - parseDate(b))
    const trainingRatings = data.filter(d => d.type === 'trening').sort((a,b) => parseDate(a) - parseDate(b))

    drawLineChart(matchChart, matchRatings, 'Ocena po meczu')
    drawLineChart(trainingChart, trainingRatings, 'Ocena po treningu')
  }

  // Rysowanie wykresu liniowego
  function drawLineChart(ctx, dataPoints, label) {
    clearCanvas(ctx)
    if(dataPoints.length === 0) {
      ctx.font = "16px Arial"
      ctx.fillText("Brak danych", 10, 50)
      return
    }

    const width = ctx.canvas.width
    const height = ctx.canvas.height
    const padding = 50

    // O≈õ Y - skala ocen od 0 do 5
    const maxRating = 5
    const minRating = 0

    // O≈õ X - daty
    const dates = dataPoints.map(d => new Date(d.date))
    const minDate = Math.min(...dates)
    const maxDate = Math.max(...dates)
    const dateRange = maxDate - minDate || 1

    // Funkcje przeliczajƒÖce warto≈õci na wsp√≥≈Çrzƒôdne
    const xPos = (date) => padding + ((date - minDate) / dateRange) * (width - 2 * padding)
    const yPos = (rating) => height - padding - ((rating - minRating) / (maxRating - minRating)) * (height - 2 * padding)

    // Rysowanie osi
    ctx.strokeStyle = "#333"
    ctx.lineWidth = 1
    ctx.beginPath()
    // O≈õ Y
    ctx.moveTo(padding, padding)
    ctx.lineTo(padding, height - padding)
    // O≈õ X
    ctx.lineTo(width - padding, height - padding)
    ctx.stroke()

    // O≈õ Y - podzia≈Çka i etykiety
    ctx.fillStyle = "#333"
    ctx.font = "12px Arial"
    for(let i=0; i <= maxRating; i++) {
      let y = yPos(i)
      ctx.beginPath()
      ctx.moveTo(padding - 5, y)
      ctx.lineTo(padding + 5, y)
      ctx.stroke()
      ctx.fillText(i.toString(), 10, y + 4)
    }

    // O≈õ X - podzia≈Çka co 3 punkty (daty)
    const dateStep = Math.max(1, Math.floor(dataPoints.length / 4))
    ctx.textAlign = "center"
    for(let i=0; i < dataPoints.length; i += dateStep) {
      let x = xPos(new Date(dataPoints[i].date))
      ctx.beginPath()
      ctx.moveTo(x, height - padding - 5)
      ctx.lineTo(x, height - padding + 5)
      ctx.stroke()
      // Format daty: dd.mm
      const d = new Date(dataPoints[i].date)
      const labelDate = `${d.getDate().toString().padStart(2,'0')}.${(d.getMonth()+1).toString().padStart(2,'0')}`
      ctx.fillText(labelDate, x, height - padding + 20)
    }

    // Rysowanie linii i punkt√≥w
    ctx.strokeStyle = "#2980b9"
    ctx.lineWidth = 2
    ctx.beginPath()
    dataPoints.forEach((p, i) => {
      let x = xPos(new Date(p.date))
      let y = yPos(p.rating)
      if(i === 0) ctx.moveTo(x, y)
      else ctx.lineTo(x, y)
    })
    ctx.stroke()

    // Punkty na wykresie
    ctx.fillStyle = "#2980b9"
    dataPoints.forEach(p => {
      let x = xPos(new Date(p.date))
      let y = yPos(p.rating)
      ctx.beginPath()
      ctx.arc(x, y, 5, 0, 2*Math.PI)
      ctx.fill()
    })

    // Tytu≈Ç wykresu
    ctx.fillStyle = "#2c3e50"
    ctx.font = "16px Arial"
    ctx.textAlign = "center"
    ctx.fillText(label, width / 2, padding / 2)
  }

  // Inicjalizacja
  renderTeams()
  renderTeamSelect()

</script>

</body>
</html>

