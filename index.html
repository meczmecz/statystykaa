<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zarządzanie Drużynami i Meczami</title>
<style>
  body { font-family: Arial,sans-serif; background:#f9f9f9; margin:0; padding:0; }
  header { background:#007bff; color:#fff; padding:15px; text-align:center; }
  nav { display:flex; justify-content:center; background:#0056b3; }
  nav button {
    padding:10px 20px; border:none; background:transparent; color:#fff;
    cursor:pointer; font-size:16px;
  }
  nav button.active {
    background:#fff; color:#0056b3; font-weight:bold;
  }
  main > section {
    display:none; padding:20px; max-width:900px; margin:15px auto;
    background:#fff; border-radius:8px; box-shadow:0 0 8px rgba(0,0,0,0.1);
  }
  main > section.active { display:block; }
  form label { display:block; margin-top:10px; font-weight:bold; }
  form input[type=text], form input[type=date], form select, form button {
    margin-top:5px; padding:8px; font-size:14px; width:100%; max-width:300px; box-sizing:border-box;
  }
  select[multiple] { height:100px; }
  ul { list-style:none; padding-left:0; }
  ul li { margin:10px 0; }
  ul li input[type=text] { width:200px; margin-right:10px; }
  ul li button {
    background:#dc3545; border:none; color:#fff; padding:5px 10px; cursor:pointer; border-radius:4px;
  }
  ul li button:hover { background:#c82333; }
  .btn-primary {
    background:#007bff; border:none; color:#fff; padding:10px 15px;
    cursor:pointer; border-radius:4px; font-size:16px; margin-top:10px; max-width:300px;
  }
  .btn-primary:hover { background:#0056b3; }
</style>
</head>
<body>

<header>
  <h1>Zarządzanie Drużynami i Meczami</h1>
</header>

<nav>
  <button id="tabTeams" class="active">Drużyny</button>
  <button id="tabPlayers">Zawodnicy</button>
  <button id="tabMatches">Mecze</button>
</nav>

<main>

  <section id="sectionTeams" class="active">
    <h2>Drużyny</h2>
    <form id="teamForm">
      <label for="teamName">Dodaj nową drużynę</label>
      <input type="text" id="teamName" placeholder="Nazwa drużyny" required />
      <button class="btn-primary" type="submit">Dodaj drużynę</button>
    </form>
    <h3>Lista drużyn</h3>
    <ul id="teamsList"></ul>
  </section>

  <section id="sectionPlayers">
    <h2>Zawodnicy</h2>
    <form id="playerForm">
      <label for="playerName">Imię i nazwisko zawodnika</label>
      <input type="text" id="playerName" placeholder="Imię i nazwisko" required />
      <label for="playerTeam">Wybierz drużynę</label>
      <select id="playerTeam" required>
        <option value="">-- wybierz drużynę --</option>
      </select>
      <button class="btn-primary" type="submit">Dodaj zawodnika</button>
    </form>
    <h3>Lista zawodników</h3>
    <ul id="playersList"></ul>
  </section>

  <section id="sectionMatches">
    <h2>Mecze</h2>
    <form id="matchForm">
      <label for="teamASelect">Drużyna A</label>
      <select id="teamASelect" required>
        <option value="">-- wybierz drużynę A --</option>
      </select>

      <label for="teamBSelect">Drużyna B</label>
      <select id="teamBSelect" required>
        <option value="">-- wybierz drużynę B --</option>
      </select>

      <label for="matchDate">Data meczu</label>
      <input type="date" id="matchDate" required />

      <label for="matchScore">Wynik meczu (np. 2:1)</label>
      <input type="text" id="matchScore" placeholder="np. 2:1" required />

      <label>3 najlepszych zawodników Drużyny A (z Ctrl/Cmd wybierz 3)</label>
      <select id="teamABestPlayers" multiple required></select>

      <label>3 najlepszych zawodników Drużyny B (z Ctrl/Cmd wybierz 3)</label>
      <select id="teamBBestPlayers" multiple required></select>

      <button class="btn-primary" type="submit">Dodaj mecz</button>
    </form>
    <h3>Lista meczów</h3>
    <ul id="matchesList"></ul>
  </section>

</main>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  // KONFIGURACJA FIREBASE - wstaw swoje dane
  const firebaseConfig = {
    apiKey: "AIzaSyAWXiBO5-woCCEqCBc2rfOIo1RhUUtevzU",
    authDomain: "jaguar-analityka.firebaseapp.com",
    databaseURL: "https://jaguar-analityka-default-rtdb.firebaseio.com",
    projectId: "jaguar-analityka",
    storageBucket: "jaguar-analityka.firebasestorage.app",
    messagingSenderId: "163915747034",
    appId: "1:163915747034:web:8c0311eaaa4ed792b25fe3",
    measurementId: "G-T3C1M10SM6"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let teamsData = {};
  let playersData = {};

  function loadTeamsSelects() {
    db.ref('teams').once('value').then(snapshot => {
      teamsData = snapshot.val() || {};
      const playerTeamSelect = document.getElementById('playerTeam');
      playerTeamSelect.innerHTML = '<option value="">-- wybierz drużynę --</option>';
      const teamASelect = document.getElementById('teamASelect');
      const teamBSelect = document.getElementById('teamBSelect');
      teamASelect.innerHTML = '<option value="">-- wybierz drużynę A --</option>';
      teamBSelect.innerHTML = '<option value="">-- wybierz drużynę B --</option>';
      for (const id in teamsData) {
        const opt1 = document.createElement('option');
        opt1.value = id;
        opt1.textContent = teamsData[id].name;
        playerTeamSelect.appendChild(opt1);
        const opt2 = document.createElement('option');
        opt2.value = id;
        opt2.textContent = teamsData[id].name;
        teamASelect.appendChild(opt2);
      }
    });
  }

  function loadPlayersForSelect(teamId, selectElement) {
    if (!teamId) {
      selectElement.innerHTML = '';
      return;
    }
    db.ref(`players/${teamId}`).once('value').then(snapshot => {
      const players = snapshot.val() || {};
      playersData[teamId] = players;
      selectElement.innerHTML = '';
      for (const pid in players) {
        const opt = document.createElement('option');
        opt.value = pid;
        opt.textContent = players[pid].name;
        selectElement.appendChild(opt);
      }
    });
  }

  function loadTeamsList() {
    db.ref('teams').once('value').then(snapshot => {
      teamsData = snapshot.val() || {};
      const ul = document.getElementById('teamsList');
      ul.innerHTML = '';
      for (const id in teamsData) {
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="text" value="${teamsData[id].name}" data-id="${id}" class="editTeamName" />
          <button data-id="${id}" class="deleteTeamBtn">Usuń</button>
        `;
        ul.appendChild(li);
      }
    });
  }

  function loadPlayersList() {
    const ul = document.getElementById('playersList');
    ul.innerHTML = '';
    db.ref('players').once('value').then(snapshot => {
      const allPlayers = snapshot.val() || {};
      for (const teamId in allPlayers) {
        for (const pid in allPlayers[teamId]) {
          const player = allPlayers[teamId][pid];
          const li = document.createElement('li');
          li.textContent = `${player.name} (drużyna: ${teamsData[teamId] ? teamsData[teamId].name : 'nieznana'})`;
          ul.appendChild(li);
        }
      }
    });
  }

  function loadMatchesList() {
    const ul = document.getElementById('matchesList');
    ul.innerHTML = '';
    db.ref('matches').once('value').then(snapshot => {
      const matches = snapshot.val() || {};
      for (const mid in matches) {
        const m = matches[mid];
        // Pobierz nazwy drużyn i zawodników dla lepszego wyświetlenia
        const teamAName = teamsData[m.teamA] ? teamsData[m.teamA].name : '???';
        const teamBName = teamsData[m.teamB] ? teamsData[m.teamB].name : '???';
        let bestA = '', bestB = '';

        if (playersData[m.teamA]) {
          bestA = m.bestPlayersA.map(pid => playersData[m.teamA][pid]?.name || '???').join(', ');
        }
        if (playersData[m.teamB]) {
          bestB = m.bestPlayersB.map(pid => playersData[m.teamB][pid]?.name || '???').join(', ');
        }

        const li = document.createElement('li');
        li.innerHTML = `<strong>${teamAName}</strong> vs <strong>${teamBName}</strong> | ${m.date} | Wynik: ${m.score} <br>
          Najlepsi ${teamAName}: ${bestA} <br>
          Najlepsi ${teamBName}: ${bestB}`;
        ul.appendChild(li);
      }
    });
  }

  // Obsługa dodawania drużyny
  document.getElementById('teamForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('teamName').value.trim();
    if (!name) return alert('Wpisz nazwę drużyny');
    const newTeamRef = db.ref('teams').push();
    newTeamRef.set({name})
      .then(() => {
        document.getElementById('teamName').value = '';
        loadTeamsSelects();
        loadTeamsList();
      })
      .catch(err => alert('Błąd dodawania drużyny: ' + err.message));
  });

  // Edycja nazwy drużyny i usuwanie
  document.getElementById('teamsList').addEventListener('input', e => {
    if (e.target.classList.contains('editTeamName')) {
      const id = e.target.dataset.id;
      const newName = e.target.value.trim();
      if (newName.length > 0) {
        db.ref(`teams/${id}`).update({name: newName});
        loadTeamsSelects();
      }
    }
  });
  document.getElementById('teamsList').addEventListener('click', e => {
    if (e.target.classList.contains('deleteTeamBtn')) {
      const id = e.target.dataset.id;
      if (confirm('Na pewno usunąć tę drużynę? To usunie również jej zawodników!')) {
        db.ref(`teams/${id}`).remove();
        db.ref(`players/${id}`).remove();
        loadTeamsSelects();
        loadTeamsList();
        loadPlayersList();
      }
    }
  });

  // Dodawanie zawodnika
  document.getElementById('playerForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('playerName').value.trim();
    const teamId = document.getElementById('playerTeam').value;
    if (!name || !teamId) return alert('Wypełnij wszystkie pola');
    const newPlayerRef = db.ref(`players/${teamId}`).push();
    newPlayerRef.set({name})
      .then(() => {
        document.getElementById('playerName').value = '';
        document.getElementById('playerTeam').value = '';
        loadPlayersList();
      })
      .catch(err => alert('Błąd dodawania zawodnika: ' + err.message));
  });

  // Po wyborze drużyny A ustawiamy drużyny B i zawodników
  document.getElementById('teamASelect').addEventListener('change', e => {
    const teamAId = e.target.value;
    const teamBSelect = document.getElementById('teamBSelect');
    teamBSelect.innerHTML = '<option value="">-- wybierz drużynę B --</option>';
    for (const id in teamsData) {
      if (id !== teamAId) {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = teamsData[id].name;
        teamBSelect.appendChild(opt);
      }
    }
    // Załaduj zawodników drużyny A do selecta najlepszych
    loadPlayersForSelect(teamAId, document.getElementById('teamABestPlayers'));
    // Czyścimy najlepszych drużyny B
    document.getElementById('teamBBestPlayers').innerHTML = '';
  });

  // Po wyborze drużyny B ładujemy zawodników
  document.getElementById('teamBSelect').addEventListener('change', e => {
    const teamBId = e.target.value;
    loadPlayersForSelect(teamBId, document.getElementById('teamBBestPlayers'));
  });

  // Dodawanie meczu
  document.getElementById('matchForm').addEventListener('submit', e => {
    e.preventDefault();
    const teamA = document.getElementById('teamASelect').value;
    const teamB = document.getElementById('teamBSelect').value;
    const date = document.getElementById('matchDate').value;
    const score = document.getElementById('matchScore').value.trim();

    const bestPlayersA = Array.from(document.getElementById('teamABestPlayers').selectedOptions).map(opt => opt.value);
    const bestPlayersB = Array.from(document.getElementById('teamBBestPlayers').selectedOptions).map(opt => opt.value);

    if (!teamA || !teamB || !date || !score) {
      return alert('Wypełnij wszystkie pola meczu');
    }
    if (bestPlayersA.length !== 3 || bestPlayersB.length !== 3) {
      return alert('Wybierz dokładnie 3 najlepszych zawodników dla każdej drużyny');
    }

    const newMatchRef = db.ref('matches').push();
    newMatchRef.set({
      teamA, teamB, date, score,
      bestPlayersA, bestPlayersB
    })
    .then(() => {
      // Czyścimy formularz
      document.getElementById('teamASelect').value = '';
      document.getElementById('teamBSelect').innerHTML = '<option value="">-- wybierz drużynę B --</option>';
      document.getElementById('matchDate').value = '';
      document.getElementById('matchScore').value = '';
      document.getElementById('teamABestPlayers').innerHTML = '';
      document.getElementById('teamBBestPlayers').innerHTML = '';
      loadMatchesList();
    })
    .catch(err => alert('Błąd dodawania meczu: ' + err.message));
  });

  // --- NAWIGACJA MIĘDZY ZAKŁADKAMI ---
  const tabs = {
    tabTeams: 'sectionTeams',
    tabPlayers: 'sectionPlayers',
    tabMatches: 'sectionMatches'
  };
  for (const tabId in tabs) {
    document.getElementById(tabId).addEventListener('click', () => {
      for (const t in tabs) {
        document.getElementById(t).classList.remove('active');
        document.getElementById(tabs[t]).classList.remove('active');
      }
      document.getElementById(tabId).classList.add('active');
      document.getElementById(tabs[tabId]).classList.add('active');
    });
  }

  // --- INICJALIZACJA ---
  function init() {
    loadTeamsSelects();
    loadTeamsList();
    loadPlayersList();
    loadMatchesList();
  }
  init();

</script>

</body>
</html>
