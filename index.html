<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trener Jaguara - Panel</title>
  <style>
    /* Reset i podstawowy styl */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0; background: #f5f7fa; color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #003366;
      color: white;
      padding: 15px 30px;
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 1.2px;
      user-select: none;
    }
    nav {
      background: #0066cc;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 12px 0;
    }
    nav button {
      background: transparent;
      border: none;
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }
    nav button:hover,
    nav button.active {
      background: #004080;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }
    main {
      flex: 1;
      padding: 20px 30px;
      max-width: 1100px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.07);
      border-radius: 12px;
      margin-top: 20px;
      margin-bottom: 40px;
    }
    h2 {
      margin-top: 0;
      color: #003366;
      border-bottom: 3px solid #0066cc;
      padding-bottom: 6px;
      margin-bottom: 20px;
      font-weight: 700;
    }
    form label {
      display: block;
      font-weight: 600;
      margin-top: 12px;
      margin-bottom: 6px;
      color: #004080;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1.8px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      border-color: #0066cc;
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 70px;
    }
    button {
      background: #0066cc;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 18px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background: #004080;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 18px;
      font-size: 0.95rem;
    }
    th, td {
      padding: 10px 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #004080;
      color: white;
      font-weight: 600;
      user-select: none;
    }
    tr:nth-child(even) {
      background-color: #f7f9fc;
    }
    .error-msg {
      color: #cc0000;
      font-weight: 600;
      margin-top: 8px;
    }
    .success-msg {
      color: #006600;
      font-weight: 600;
      margin-top: 8px;
    }
    /* Layout na zakładki */
    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    /* Responsive */
    @media (max-width: 720px) {
      main {
        margin: 10px 15px 40px 15px;
        padding: 15px;
      }
      nav {
        flex-wrap: wrap;
      }
      nav button {
        flex: 1 1 45%;
        margin-bottom: 8px;
      }
      th, td {
        font-size: 0.85rem;
        padding: 8px 6px;
      }
    }
    /* Wykresy */
    canvas {
      max-width: 100%;
      height: 300px;
      margin-top: 20px;
    }
    /* Scroll w tabelkach */
    .table-wrapper {
      overflow-x: auto;
    }
    /* Edytowalne pola w tabelkach */
    td.editable {
      cursor: pointer;
      background-color: #eef6ff;
      transition: background-color 0.3s;
    }
    td.editable:hover {
      background-color: #d1e5ff;
    }
  </style>
</head>
<body>

<header>
  Trener Jaguara - Panel zarządzania
</header>

<nav>
  <button id="tabMatches" class="active" aria-controls="matchesSection">Analiza meczy</button>
  <button id="tabTeams" aria-controls="teamsSection">Drużyny</button>
  <button id="tabPlayers" aria-controls="playersSection">Zawodnicy</button>
</nav>

<main>

  <!-- ZAKŁADKA 1: Analiza meczy -->
  <section id="matchesSection" class="tab-content active" role="tabpanel" tabindex="0" aria-labelledby="tabMatches">
    <h2>Analiza meczy</h2>
    <form id="matchForm" aria-label="Formularz dodawania meczu">
      <label for="matchDate">Data meczu:</label>
      <input type="date" id="matchDate" name="matchDate" required aria-required="true" />

      <label for="matchRating">Ocena meczu (1-5):</label>
      <select id="matchRating" name="matchRating" required aria-required="true" >
        <option value="">Wybierz</option>
        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        <option value="4">4</option><option value="5">5</option>
      </select>

      <label for="matchResult">Wynik meczu:</label>
      <input type="text" id="matchResult" name="matchResult" placeholder="np. 3:2" required aria-required="true" />

      <label for="goalScorers">Kto strzelił bramki (oddziel przecinkami):</label>
      <textarea id="goalScorers" name="goalScorers" placeholder="Jan Kowalski, Adam Nowak"></textarea>

      <label for="bestPlayer">Najlepszy zawodnik (wybierz z listy):</label>
      <select id="bestPlayer" name="bestPlayer">
        <option value="">Brak</option>
      </select>

      <fieldset style="margin-top:15px;">
        <legend>Najlepsi zawodnicy z Jaguaara (3 miejsca)</legend>
        <select id="topJaguar1"></select>
        <select id="topJaguar2"></select>
        <select id="topJaguar3"></select>
      </fieldset>

      <fieldset style="margin-top:15px;">
        <legend>Najlepsi zawodnicy z drużyny przeciwnej (3 miejsca)</legend>
        <select id="topOpponent1"></select>
        <select id="topOpponent2"></select>
        <select id="topOpponent3"></select>
      </fieldset>

      <button type="submit" aria-label="Dodaj mecz">Dodaj mecz</button>
      <div id="matchFormMsg"></div>
    </form>

    <h3>Lista meczy</h3>
    <div class="table-wrapper" style="max-height: 350px; overflow-y: auto;">
      <table aria-label="Tabela meczy">
        <thead>
          <tr>
            <th>Data</th>
            <th>Ocena</th>
            <th>Wynik</th>
            <th>Bramki</th>
            <th>Najlepszy zawodnik</th>
            <th>3 top Jaguar</th>
            <th>3 top Przeciwnik</th>
            <th>Opcje</th>
          </tr>
        </thead>
        <tbody id="matchesTableBody"></tbody>
      </table>
    </div>
  </section>

  <!-- ZAKŁADKA 2: Drużyny -->
  <section id="teamsSection" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tabTeams">
    <h2>Drużyny Jaguara</h2>
    <form id="teamForm" aria-label="Formularz dodawania drużyny">
      <label for="teamName">Nazwa drużyny:</label>
      <input type="text" id="teamName" name="teamName" placeholder="Wpisz nazwę drużyny" required aria-required="true" />

      <button type="submit" aria-label="Dodaj drużynę">Dodaj drużynę</button>
      <div id="teamFormMsg"></div>
    </form>

    <h3>Lista drużyn</h3>
    <div class="table-wrapper" style="max-height: 300px; overflow-y: auto;">
      <table aria-label="Tabela drużyn">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nazwa drużyny</th>
            <th>Opcje</th>
          </tr>
        </thead>
        <tbody id="teamsTableBody"></tbody>
      </table>
    </div>
  </section>

  <!-- ZAKŁADKA 3: Zawodnicy -->
  <section id="playersSection" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="tabPlayers">
    <h2>Zawodnicy i oceny</h2>
    <form id="playerForm" aria-label="Formularz dodawania zawodnika i oceny">
      <label for="selectTeamForPlayer">Wybierz drużynę:</label>
      <select id="selectTeamForPlayer" name="selectTeamForPlayer" required aria-required="true">
        <option value="">Wybierz drużynę</option>
      </select>

      <label for="selectPlayer">Wybierz zawodnika:</label>
      <select id="selectPlayer" name="selectPlayer" required aria-required="true" disabled>
        <option value="">Najpierw wybierz drużynę</option>
      </select>

      <label for="trainingRating">Ocena z treningu (1-5):</label>
      <select id="trainingRating" name="trainingRating">
        <option value="">Brak</option>
        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        <option value="4">4</option><option value="5">5</option>
      </select>

      <label for="matchRatingPlayer">Ocena z meczu (1-5):</label>
      <select id="matchRatingPlayer" name="matchRatingPlayer">
        <option value="">Brak</option>
        <option value="1">1</option><option value="2">2</option><option value="3">3</option>
        <option value="4">4</option><option value="5">5</option>
      </select>

      <label for="playTime">Czas na boisku (minuty):</label>
      <input type="number" id="playTime" name="playTime" min="0" placeholder="np. 90" />

      <label for="ratingDate">Data oceny:</label>
      <input type="date" id="ratingDate" name="ratingDate" required aria-required="true" />

      <button type="submit" aria-label="Dodaj ocenę zawodnika">Dodaj ocenę</button>
      <div id="playerFormMsg"></div>
    </form>

    <h3>Progres zawodnika (wykresy)</h3>
    <label for="selectPlayerChart">Wybierz zawodnika:</label>
    <select id="selectPlayerChart" aria-label="Wybierz zawodnika do wykresu" style="width: 100%; max-width: 300px; margin-bottom: 15px;">
      <option value="">Wybierz zawodnika</option>
    </select>

    <canvas id="trainingChart" aria-label="Wykres ocen z treningów" role="img"></canvas>
    <canvas id="matchChart" aria-label="Wykres ocen z meczy" role="img"></canvas>

  </section>
</main>

<!-- Skrypty -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // ------ KONFIGURACJA Supabase ------
  const SUPABASE_URL = 'TWOJ_SUPABASE_URL_TUTAJ'; // PODMIEN NA SWOJ URL
  const SUPABASE_KEY = 'TWOJ_SUPABASE_ANON_KEY_TUTAJ'; // PODMIEN NA SWOJ KLUCZ

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ------ ELEMENTY HTML ------
  const tabs = {
    matches: document.getElementById('tabMatches'),
    teams: document.getElementById('tabTeams'),
    players: document.getElementById('tabPlayers'),
  };

  const sections = {
    matches: document.getElementById('matchesSection'),
    teams: document.getElementById('teamsSection'),
    players: document.getElementById('playersSection'),
  };

  // Formularze
  const matchForm = document.getElementById('matchForm');
  const teamForm = document.getElementById('teamForm');
  const playerForm = document.getElementById('playerForm');

  // Kontenery na dane
  const matchesTableBody = document.getElementById('matchesTableBody');
  const teamsTableBody = document.getElementById('teamsTableBody');

  // Wybory w formularzach
  const bestPlayerSelect = document.getElementById('bestPlayer');

  // 3 najlepszych zawodników
  const topJaguarSelects = [
    document.getElementById('topJaguar1'),
    document.getElementById('topJaguar2'),
    document.getElementById('topJaguar3'),
  ];
  const topOpponentSelects = [
    document.getElementById('topOpponent1'),
    document.getElementById('topOpponent2'),
    document.getElementById('topOpponent3'),
  ];

  // Zawodnicy - selekcje i wykresy
  const selectTeamForPlayer = document.getElementById('selectTeamForPlayer');
  const selectPlayer = document.getElementById('selectPlayer');
  const selectPlayerChart = document.getElementById('selectPlayerChart');
  const trainingChartCtx = document.getElementById('trainingChart').getContext('2d');
  const matchChartCtx = document.getElementById('matchChart').getContext('2d');

  // Wiadomości o statusie
  const matchFormMsg = document.getElementById('matchFormMsg');
  const teamFormMsg = document.getElementById('teamFormMsg');
  const playerFormMsg = document.getElementById('playerFormMsg');

  // ------- STAN APLIKACJI -------
  let teams = [];
  let players = [];
  let matches = [];
  let ratings = [];

  // ------- FUNKCJE POMOCNICZE -------

  // Przełączanie zakładek
  function switchTab(tabName) {
    Object.keys(tabs).forEach(key => {
      if (key === tabName) {
        tabs[key].classList.add('active');
        sections[key].classList.add('active');
        sections[key].focus();
      } else {
        tabs[key].classList.remove('active');
        sections[key].classList.remove('active');
      }
    });
  }

  // Załaduj wszystkie drużyny z bazy
  async function loadTeams() {
    const { data, error } = await supabase.from('teams').select('*').order('name');
    if (error) {
      console.error('Błąd wczytywania drużyn:', error.message);
      return;
    }
    teams = data;
    renderTeamsTable();
    populateTeamSelects();
  }

  // Wyświetl drużyny w tabeli
  function renderTeamsTable() {
    teamsTableBody.innerHTML = '';
    teams.forEach(team => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${team.id}</td>
        <td>${team.name}</td>
        <td>
          <button onclick="deleteTeam(${team.id})" aria-label="Usuń drużynę ${team.name}">Usuń</button>
        </td>
      `;
      teamsTableBody.appendChild(tr);
    });
  }

  // Wypełnij selecty drużyn w formularzach
  function populateTeamSelects() {
    // Wyczyść wszystkie
    [selectTeamForPlayer].forEach(sel => {
      sel.innerHTML = '<option value="">Wybierz drużynę</option>';
      teams.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t.id;
        opt.textContent = t.name;
        sel.appendChild(opt);
      });
    });
  }

  // Usuń drużynę
  async function deleteTeam(id) {
    if (!confirm('Na pewno chcesz usunąć tę drużynę? Usunie to też zawodników i powiązane dane!')) return;

    const { error } = await supabase.from('teams').delete().eq('id', id);
    if (error) {
      alert('Błąd usuwania drużyny: ' + error.message);
      return;
    }
    alert('Drużyna usunięta');
    await loadTeams();
    await loadPlayers();
  }

  // Załaduj zawodników
  async function loadPlayers() {
    const { data, error } = await supabase.from('players').select('*').order('name');
    if (error) {
      console.error('Błąd wczytywania zawodników:', error.message);
      return;
    }
    players = data;
    populatePlayersSelects();
    populateBestPlayerSelect();
  }

  // Wypełnij selecty zawodników dla najlepszych w meczu i w formach
  function populateBestPlayerSelect() {
    bestPlayerSelect.innerHTML = '<option value="">Brak</option>';
    players.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = p.name;
      bestPlayerSelect.appendChild(opt);
    });

    // też do pól top Jaguar i przeciwnik
    function fillTopSelects(selects) {
      selects.forEach(sel => {
        sel.innerHTML = '<option value="">Brak</option>';
        players.forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.id;
          opt.textContent = p.name;
          sel.appendChild(opt);
        });
      });
    }
    fillTopSelects(topJaguarSelects);
    fillTopSelects(topOpponentSelects);
  }

  // Gdy wybierzesz drużynę, wczytaj zawodników tylko z niej
  async function loadPlayersByTeam(teamId) {
    if (!teamId) {
      selectPlayer.innerHTML = '<option value="">Najpierw wybierz drużynę</option>';
      selectPlayer.disabled = true;
      return;
    }
    const { data, error } = await supabase.from('players').select('*').eq('team_id', teamId).order('name');
    if (error) {
      console.error('Błąd wczytywania zawodników drużyny:', error.message);
      return;
    }
    // Wypełnij select
    selectPlayer.innerHTML = '<option value="">Wybierz zawodnika</option>';
    data.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = p.name;
      selectPlayer.appendChild(opt);
    });
    selectPlayer.disabled = false;
  }

  // Załaduj mecze
  async function loadMatches() {
    const { data, error } = await supabase.from('matches').select('*').order('date', { ascending: false });
    if (error) {
      console.error('Błąd wczytywania meczy:', error.message);
      return;
    }
    matches = data;
    renderMatchesTable();
  }

  // Wyświetl mecze w tabeli
  async function renderMatchesTable() {
    matchesTableBody.innerHTML = '';
    for (const m of matches) {
      // Pobierz nazwy zawodników po ID, jeśli są
      const bestPlayerName = await getPlayerNameById(m.best_player_id);
      const topJaguarNames = await getPlayersNamesByIds([m.top_jaguar_1, m.top_jaguar_2, m.top_jaguar_3]);
      const topOpponentNames = await getPlayersNamesByIds([m.top_opponent_1, m.top_opponent_2, m.top_opponent_3]);

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${m.date}</td>
        <td>${m.rating}</td>
        <td>${m.result}</td>
        <td>${m.goal_scorers || ''}</td>
        <td>${bestPlayerName || ''}</td>
        <td>${topJaguarNames.join(', ')}</td>
        <td>${topOpponentNames.join(', ')}</td>
        <td><button onclick="deleteMatch(${m.id})" aria-label="Usuń mecz z dnia ${m.date}">Usuń</button></td>
      `;
      matchesTableBody.appendChild(tr);
    }
  }

  async function getPlayerNameById(id) {
    if (!id) return '';
    // Szukaj w cache players
    const p = players.find(p => p.id === id);
    if (p) return p.name;
    // Jeśli nie ma, spróbuj z bazy
    const { data, error } = await supabase.from('players').select('name').eq('id', id).single();
    if (error || !data) return '';
    return data.name;
  }

  async function getPlayersNamesByIds(ids) {
    const names = [];
    for (const id of ids) {
      if (!id) continue;
      const n = await getPlayerNameById(id);
      if (n) names.push(n);
    }
    return names;
  }

  // Usuń mecz
  async function deleteMatch(id) {
    if (!confirm('Na pewno chcesz usunąć ten mecz?')) return;

    const { error } = await supabase.from('matches').delete().eq('id', id);
    if (error) {
      alert('Błąd usuwania meczu: ' + error.message);
      return;
    }
    alert('Mecz usunięty');
    await loadMatches();
  }

  // Dodaj drużynę
  teamForm.addEventListener('submit', async e => {
    e.preventDefault();
    const name = teamForm.teamName.value.trim();
    if (!name) {
      teamFormMsg.textContent = 'Podaj nazwę drużyny!';
      teamFormMsg.className = 'error-msg';
      return;
    }
    const { data, error } = await supabase.from('teams').insert([{ name }]);
    if (error) {
      teamFormMsg.textContent = 'Błąd dodawania drużyny: ' + error.message;
      teamFormMsg.className = 'error-msg';
      return;
    }
    teamFormMsg.textContent = 'Drużyna dodana!';
    teamFormMsg.className = 'success-msg';
    teamForm.reset();
    await loadTeams();
  });

  // Dodaj mecz
  matchForm.addEventListener('submit', async e => {
    e.preventDefault();
    // Pobierz dane z formularza
    const date = matchForm.matchDate.value;
    const rating = parseInt(matchForm.matchRating.value);
    const result = matchForm.matchResult.value.trim();
    const goalScorers = matchForm.goalScorers.value.trim();
    const bestPlayerId = matchForm.bestPlayer.value || null;
    const topJaguar1 = matchForm.topJaguar1.value || null;
    const topJaguar2 = matchForm.topJaguar2.value || null;
    const topJaguar3 = matchForm.topJaguar3.value || null;
    const topOpponent1 = matchForm.topOpponent1.value || null;
    const topOpponent2 = matchForm.topOpponent2.value || null;
    const topOpponent3 = matchForm.topOpponent3.value || null;

    // Walidacja
    if (!date || !rating || !result) {
      matchFormMsg.textContent = 'Proszę uzupełnić wymagane pola!';
      matchFormMsg.className = 'error-msg';
      return;
    }

    const { data, error } = await supabase.from('matches').insert([{
      date,
      rating,
      result,
      goal_scorers: goalScorers || null,
      best_player_id: bestPlayerId,
      top_jaguar_1: topJaguar1,
      top_jaguar_2: topJaguar2,
      top_jaguar_3: topJaguar3,
      top_opponent_1: topOpponent1,
      top_opponent_2: topOpponent2,
      top_opponent_3: topOpponent3,
    }]);

    if (error) {
      matchFormMsg.textContent = 'Błąd dodawania meczu: ' + error.message;
      matchFormMsg.className = 'error-msg';
      return;
    }
    matchFormMsg.textContent = 'Mecz dodany!';
    matchFormMsg.className = 'success-msg';
    matchForm.reset();
    await loadMatches();
  });

  // Dodaj zawodnika (i oceny)
  playerForm.addEventListener('submit', async e => {
    e.preventDefault();
    const teamId = selectTeamForPlayer.value;
    const playerId = selectPlayer.value;
    const trainingRating = playerForm.trainingRating.value || null;
    const matchRating = playerForm.matchRatingPlayer.value || null;
    const playTime = playerForm.playTime.value ? parseInt(playerForm.playTime.value) : null;
    const ratingDate = playerForm.ratingDate.value;

    if (!teamId || !playerId || !ratingDate) {
      playerFormMsg.textContent = 'Uzupełnij wymagane pola!';
      playerFormMsg.className = 'error-msg';
      return;
    }

    // Wstaw ocenę do tabeli ratings
    const { data, error } = await supabase.from('ratings').insert([{
      player_id: playerId,
      team_id: teamId,
      training_rating: trainingRating ? parseInt(trainingRating) : null,
      match_rating: matchRating ? parseInt(matchRating) : null,
      play_time: playTime,
      date: ratingDate,
    }]);
    if (error) {
      playerFormMsg.textContent = 'Błąd dodawania oceny: ' + error.message;
      playerFormMsg.className = 'error-msg';
      return;
    }
    playerFormMsg.textContent = 'Ocena dodana!';
    playerFormMsg.className = 'success-msg';
    playerForm.reset();
    await loadRatings();
  });

  // Załaduj oceny (ratings)
  async function loadRatings() {
    const { data, error } = await supabase.from('ratings').select('*').order('date');
    if (error) {
      console.error('Błąd wczytywania ocen:', error.message);
      return;
    }
    ratings = data;
    renderPlayerChart(); // odśwież wykresy
  }

  // Wypełnij select zawodników do wykresów
  function populatePlayersSelectForChart() {
    selectPlayerChart.innerHTML = '<option value="">Wybierz zawodnika</option>';
    players.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = p.name;
      selectPlayerChart.appendChild(opt);
    });
  }

  // Obsługa wyboru zawodnika na wykres
  selectPlayerChart.addEventListener('change', renderPlayerChart);

  let chartTraining = null;
  let chartMatch = null;

  // Rysuj wykresy progresu zawodnika
  function renderPlayerChart() {
    const playerId = selectPlayerChart.value;
    if (!playerId) {
      clearCharts();
      return;
    }
    // Filtruj oceny zawodnika
    const playerRatings = ratings.filter(r => r.player_id === playerId);

    // Sortuj wg daty rosnąco
    playerRatings.sort((a,b) => new Date(a.date) - new Date(b.date));

    const labels = playerRatings.map(r => r.date);
    const trainingData = playerRatings.map(r => r.training_rating || null);
    const matchData = playerRatings.map(r => r.match_rating || null);

    // Zniszcz stare wykresy jeśli są
    if (chartTraining) chartTraining.destroy();
    if (chartMatch) chartMatch.destroy();

    chartTraining = new Chart(trainingChartCtx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Ocena treningu',
          data: trainingData,
          borderColor: '#007acc',
          backgroundColor: 'rgba(0,122,204,0.2)',
          spanGaps: true,
          tension: 0.3,
          fill: true,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            min: 0,
            max: 5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });

    chartMatch = new Chart(matchChartCtx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Ocena meczu',
          data: matchData,
          borderColor: '#e63946',
          backgroundColor: 'rgba(230,57,70,0.2)',
          spanGaps: true,
          tension: 0.3,
          fill: true,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            min: 0,
            max: 5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  }

  function clearCharts() {
    if (chartTraining) chartTraining.destroy();
    if (chartMatch) chartMatch.destroy();
  }

  // Inicjalizacja
  (async function init() {
    await loadTeams();
    await loadPlayers();
    await loadMatches();
    await loadRatings();
    populatePlayersSelectForChart();

    // Przełącz na zakładkę z meczami domyślnie
    switchTab('matches');
  })();

  // Zmiana drużyny w formularzu oceny zawodnika
  selectTeamForPlayer.addEventListener('change', async e => {
    await loadPlayersByTeam(e.target.value);
  });

  // Zakładki - obsługa kliknięć
  Object.entries(tabs).forEach(([key, tab]) => {
    tab.addEventListener('click', () => switchTab(key));
  });

  // Eksport funkcji globalnych dla przycisków w tabelach
  window.deleteTeam = deleteTeam;
  window.deleteMatch = deleteMatch;

</script>
</body>
</html>
