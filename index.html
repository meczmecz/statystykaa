<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zarządzanie Drużynami i Meczami</title>
<style>
  body { font-family: Arial,sans-serif; background:#f9f9f9; margin:0; padding:0; }
  header { background:#007bff; color:#fff; padding:15px; text-align:center; }
  nav { display:flex; justify-content:center; background:#0056b3; }
  nav button {
    padding:10px 20px; border:none; background:transparent; color:#fff;
    cursor:pointer; font-size:16px;
  }
  nav button.active {
    background:#fff; color:#0056b3; font-weight:bold;
  }
  main > section {
    display:none; padding:20px; max-width:900px; margin:15px auto;
    background:#fff; border-radius:8px; box-shadow:0 0 8px rgba(0,0,0,0.1);
  }
  main > section.active { display:block; }
  form label { display:block; margin-top:10px; font-weight:bold; }
  form input[type=text], form input[type=date], form select, form button {
    margin-top:5px; padding:8px; font-size:14px; width:100%; max-width:300px; box-sizing:border-box;
  }
  select[multiple] { height:100px; }
  ul { list-style:none; padding-left:0; }
  ul li { margin:10px 0; display:flex; align-items:center; }
  ul li input[type=text] { width:200px; margin-right:10px; }
  ul li button {
    background:#dc3545; border:none; color:#fff; padding:5px 10px; cursor:pointer; border-radius:4px;
  }
  ul li button:hover { background:#c82333; }
  .btn-primary {
    background:#007bff; border:none; color:#fff; padding:10px 15px;
    cursor:pointer; border-radius:4px; font-size:16px; margin-top:10px; max-width:300px;
  }
  .btn-primary:hover { background:#0056b3; }
  .flex-row { display:flex; gap:10px; align-items:center; }
</style>
</head>
<body>

<header>
  <h1>Zarządzanie Drużynami i Meczami</h1>
</header>

<nav>
  <button id="tabTeams" class="active">Drużyny</button>
  <button id="tabPlayers">Zawodnicy</button>
  <button id="tabMatches">Mecze</button>
</nav>

<main>

  <section id="sectionTeams" class="active">
    <h2>Drużyny</h2>
    <form id="teamForm">
      <label for="teamName">Dodaj nową drużynę</label>
      <input type="text" id="teamName" placeholder="Nazwa drużyny" required />
      <button class="btn-primary" type="submit">Dodaj drużynę</button>
    </form>
    <h3>Lista drużyn</h3>
    <ul id="teamsList"></ul>
  </section>

  <section id="sectionPlayers">
    <h2>Zawodnicy</h2>
    <form id="playerForm">
      <label for="playerName">Imię i nazwisko zawodnika</label>
      <input type="text" id="playerName" placeholder="Imię i nazwisko" required />
      <label for="playerTeam">Wybierz drużynę</label>
      <select id="playerTeam" required>
        <option value="">-- wybierz drużynę --</option>
      </select>
      <button class="btn-primary" type="submit">Dodaj zawodnika</button>
    </form>
    <h3>Lista zawodników</h3>
    <ul id="playersList"></ul>
  </section>

  <section id="sectionMatches">
    <h2>Mecze</h2>
    <form id="matchForm">
      <label for="teamASelect">Drużyna A (moja drużyna)</label>
      <select id="teamASelect" required>
        <option value="">-- wybierz drużynę A --</option>
      </select>

      <label for="teamBSelect">Drużyna B (przeciwnik)</label>
      <select id="teamBSelect" required>
        <option value="">-- wybierz drużynę B --</option>
      </select>

      <label for="matchDate">Data meczu</label>
      <input type="date" id="matchDate" required />

      <label for="matchScore">Wynik meczu (np. 2:1)</label>
      <input type="text" id="matchScore" placeholder="np. 2:1" required />

      <label>3 najlepszych zawodników Drużyny A (z Ctrl/Cmd wybierz 3)</label>
      <select id="teamABestPlayers" multiple required></select>

      <label>3 najlepszych zawodników Drużyny B (z Ctrl/Cmd wybierz 3)</label>
      <select id="teamBBestPlayers" multiple required></select>

      <button class="btn-primary" type="submit">Dodaj mecz</button>
    </form>
    <h3>Lista meczów</h3>
    <ul id="matchesList"></ul>
  </section>

</main>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  // KONFIGURACJA FIREBASE - wstaw swoje dane
   const firebaseConfig = {
    apiKey: "AIzaSyAWXiBO5-woCCEqCBc2rfOIo1RhUUtevzU",
    authDomain: "jaguar-analityka.firebaseapp.com",
    databaseURL: "https://jaguar-analityka-default-rtdb.firebaseio.com",
    projectId: "jaguar-analityka",
    storageBucket: "jaguar-analityka.firebasestorage.app",
    messagingSenderId: "163915747034",
    appId: "1:163915747034:web:8c0311eaaa4ed792b25fe3",
    measurementId: "G-T3C1M10SM6"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let teamsData = {};
  let playersData = {};

  // Wczytaj drużyny do selectów i list
  function loadTeamsSelects() {
    db.ref('teams').once('value').then(snapshot => {
      teamsData = snapshot.val() || {};
      const playerTeamSelect = document.getElementById('playerTeam');
      playerTeamSelect.innerHTML = '<option value="">-- wybierz drużynę --</option>';
      const teamASelect = document.getElementById('teamASelect');
      const teamBSelect = document.getElementById('teamBSelect');
      teamASelect.innerHTML = '<option value="">-- wybierz drużynę A --</option>';
      teamBSelect.innerHTML = '<option value="">-- wybierz drużynę B --</option>';
      for (const id in teamsData) {
        const opt1 = document.createElement('option');
        opt1.value = id;
        opt1.textContent = teamsData[id].name;
        playerTeamSelect.appendChild(opt1);

        const optA = document.createElement('option');
        optA.value = id;
        optA.textContent = teamsData[id].name;
        teamASelect.appendChild(optA);
      }
      // Po załadowaniu drużyn odśwież listę zawodników
      loadPlayersList();
    });
  }

  // Wczytaj zawodników dla danej drużyny do selecta (np. najlepszych zawodników w meczu)
  function loadPlayersForSelect(teamId, selectElement) {
    if (!teamId) {
      selectElement.innerHTML = '';
      return;
    }
    db.ref(`players/${teamId}`).once('value').then(snapshot => {
      const players = snapshot.val() || {};
      playersData[teamId] = players;
      selectElement.innerHTML = '';
      for (const pid in players) {
        const opt = document.createElement('option');
        opt.value = pid;
        opt.textContent = players[pid].name;
        selectElement.appendChild(opt);
      }
    });
  }

  // Wczytaj listę zawodników
  function loadPlayersList() {
    db.ref('players').once('value').then(snapshot => {
      playersData = snapshot.val() || {};
      const playersList = document.getElementById('playersList');
      playersList.innerHTML = '';
      for (const teamId in playersData) {
        const teamName = teamsData[teamId]?.name || 'Nieznana drużyna';
        for (const pid in playersData[teamId]) {
          const player = playersData[teamId][pid];
          const li = document.createElement('li');
          li.textContent = player.name + ' (' + teamName + ')';

          const btnDel = document.createElement('button');
          btnDel.textContent = 'Usuń';
          btnDel.addEventListener('click', () => {
            if(confirm(`Usunąć zawodnika ${player.name} z drużyny ${teamName}?`)) {
              db.ref(`players/${teamId}/${pid}`).remove().then(() => {
                loadPlayersList();
                // odśwież selecty jeśli jest wybrana drużyna A lub B
                const teamAId = document.getElementById('teamASelect').value;
                const teamBId = document.getElementById('teamBSelect').value;
                if (teamId === teamAId) loadPlayersForSelect(teamAId, document.getElementById('teamABestPlayers'));
                if (teamId === teamBId) loadPlayersForSelect(teamBId, document.getElementById('teamBBestPlayers'));
              });
            }
          });
          li.appendChild(btnDel);
          playersList.appendChild(li);
        }
      }
    });
  }

  // Wczytaj listę drużyn (z możliwością usuwania drużyn)
  function loadTeamsList() {
    const teamsList = document.getElementById('teamsList');
    teamsList.innerHTML = '';
    for (const id in teamsData) {
      const li = document.createElement('li');
      li.textContent = teamsData[id].name + ' ';

      const btnDel = document.createElement('button');
      btnDel.textContent = 'Usuń';
      btnDel.addEventListener('click', () => {
        if(confirm(`Usunąć drużynę ${teamsData[id].name} (razem z zawodnikami)?`)) {
          db.ref(`teams/${id}`).remove()
          .then(() => db.ref(`players/${id}`).remove())
          .then(() => {
            loadTeamsSelects();
            loadMatchesList();
          });
        }
      });

      li.appendChild(btnDel);
      teamsList.appendChild(li);
    }
  }

  // Wczytaj listę meczów
  function loadMatchesList() {
    db.ref('matches').once('value').then(snapshot => {
      const matches = snapshot.val() || {};
      const matchesList = document.getElementById('matchesList');
      matchesList.innerHTML = '';
      for (const mid in matches) {
        const m = matches[mid];
        const teamAName = teamsData[m.teamA]?.name || '???';
        const teamBName = teamsData[m.teamB]?.name || '???';
        const li = document.createElement('li');
        li.textContent = `${m.date}: ${teamAName} vs ${teamBName} (Wynik: ${m.score})`;
        matchesList.appendChild(li);
      }
    });
  }

  // Dodaj drużynę
  document.getElementById('teamForm').addEventListener('submit', e => {
    e.preventDefault();
    const teamName = document.getElementById('teamName').value.trim();
    if (!teamName) return alert('Podaj nazwę drużyny');
    const newTeamRef = db.ref('teams').push();
    newTeamRef.set({ name: teamName }).then(() => {
      document.getElementById('teamName').value = '';
      loadTeamsSelects();
      loadTeamsList();
    });
  });

  // Dodaj zawodnika
  document.getElementById('playerForm').addEventListener('submit', e => {
    e.preventDefault();
    const playerName = document.getElementById('playerName').value.trim();
    const playerTeam = document.getElementById('playerTeam').value;
    if (!playerName || !playerTeam) return alert('Podaj imię zawodnika i drużynę');
    const newPlayerRef = db.ref(`players/${playerTeam}`).push();
    newPlayerRef.set({ name: playerName }).then(() => {
      document.getElementById('playerName').value = '';
      document.getElementById('playerTeam').value = '';
      loadPlayersList();
      // Odśwież selecty jeśli wybrane drużyny
      const teamAId = document.getElementById('teamASelect').value;
      const teamBId = document.getElementById('teamBSelect').value;
      if (playerTeam === teamAId) loadPlayersForSelect(teamAId, document.getElementById('teamABestPlayers'));
      if (playerTeam === teamBId) loadPlayersForSelect(teamBId, document.getElementById('teamBBestPlayers'));
    });
  });

  // Przy zmianie drużyny A ustaw listę drużyn B na inne drużyny i załaduj zawodników do wyboru najlepszych
  document.getElementById('teamASelect').addEventListener('change', e => {
    const teamAId = e.target.value;
    const teamBSelect = document.getElementById('teamBSelect');
    teamBSelect.innerHTML = '<option value="">-- wybierz drużynę B --</option>';
    for (const id in teamsData) {
      if (id !== teamAId) {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = teamsData[id].name;
        teamBSelect.appendChild(opt);
      }
    }
    // Załaduj zawodników drużyny A do wyboru najlepszych
    loadPlayersForSelect(teamAId, document.getElementById('teamABestPlayers'));
    // Wyczyść wybór drużyny B i zawodników drużyny B
    document.getElementById('teamBBestPlayers').innerHTML = '';
  });

  // Przy zmianie drużyny B załaduj zawodników do wyboru najlepszych
  document.getElementById('teamBSelect').addEventListener('change', e => {
    const teamBId = e.target.value;
    loadPlayersForSelect(teamBId, document.getElementById('teamBBestPlayers'));
  });

  // Dodaj mecz
  document.getElementById('matchForm').addEventListener('submit', e => {
    e.preventDefault();
    const teamA = document.getElementById('teamASelect').value;
    const teamB = document.getElementById('teamBSelect').value;
    const date = document.getElementById('matchDate').value;
    const score = document.getElementById('matchScore').value.trim();
    const bestPlayersA = Array.from(document.getElementById('teamABestPlayers').selectedOptions).map(opt => opt.value);
    const bestPlayersB = Array.from(document.getElementById('teamBBestPlayers').selectedOptions).map(opt => opt.value);

    if (!teamA || !teamB || !date || !score) {
      return alert('Wypełnij wszystkie pola meczu');
    }
    if (bestPlayersA.length !== 3 || bestPlayersB.length !== 3) {
      return alert('Wybierz dokładnie 3 najlepszych zawodników dla każdej drużyny');
    }

    const newMatchRef = db.ref('matches').push();
    newMatchRef.set({
      teamA, teamB, date, score,
      bestPlayersA, bestPlayersB
    })
    .then(() => {
      document.getElementById('teamASelect').value = '';
      document.getElementById('teamBSelect').innerHTML = '<option value="">-- wybierz drużynę B --</option>';
      document.getElementById('matchDate').value = '';
      document.getElementById('matchScore').value = '';
      document.getElementById('teamABestPlayers').innerHTML = '';
      document.getElementById('teamBBestPlayers').innerHTML = '';
      loadMatchesList();
    })
    .catch(err => alert('Błąd dodawania meczu: ' + err.message));
  });

  // Nawigacja między zakładkami
  const tabs = {
    tabTeams: 'sectionTeams',
    tabPlayers: 'sectionPlayers',
    tabMatches: 'sectionMatches'
  };
  for (const tabId in tabs) {
    document.getElementById(tabId).addEventListener('click', () => {
      for (const t in tabs) {
        document.getElementById(t).classList.remove('active');
        document.getElementById(tabs[t]).classList.remove('active');
      }
      document.getElementById(tabId).classList.add('active');
      document.getElementById(tabs[tabId]).classList.add('active');
    });
  }

  // Inicjalizacja
  function init() {
    loadTeamsSelects();
    loadTeamsList();
    loadPlayersList();
    loadMatchesList();
  }
  init();

</script>

</body>
</html>

