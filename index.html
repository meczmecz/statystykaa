<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dron Panel + Firebase Auth</title>
<style>
  /* ======= RESET ======= */
  * { margin:0; padding:0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1f4037, #99f2c8);
    color: #222;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  button {
    cursor: pointer;
    border: none;
    background-color: #2d8c99;
    color: white;
    padding: 0.5rem 1rem;
    margin: 0.2rem;
    border-radius: 6px;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #186a75;
  }
  input, label {
    font-size: 1rem;
  }
  input {
    padding: 0.4rem;
    border-radius: 4px;
    border: 1.5px solid #2d8c99;
    width: 100%;
    max-width: 280px;
    margin-bottom: 0.5rem;
  }
  .error-msg {
    color: #d33;
    font-size: 0.85rem;
    margin-bottom: 0.7rem;
    height: 18px;
  }
  h1,h2 {
    margin-bottom: 1rem;
    font-weight: 700;
  }
  /* CONTAINERS */
  .container {
    background: rgba(255 255 255 / 0.9);
    padding: 2rem 2.5rem 3rem;
    border-radius: 15px;
    box-shadow: 0 0 20px rgb(0 0 0 / 0.25);
    width: 320px;
    max-width: 90vw;
  }
  /* SCREENS */
  .screen {
    display: none;
  }
  .screen.active {
    display: block;
  }
  /* FORM FIELDS */
  .form-group {
    margin-bottom: 1rem;
  }
  /* LINKS */
  .switch-link {
    color: #2d8c99;
    text-decoration: underline;
    cursor: pointer;
    font-size: 0.95rem;
    margin-top: 0.5rem;
    display: inline-block;
  }
  /* DASHBOARD */
  #dashboard-info {
    margin-bottom: 1.5rem;
  }
  #dashboard-info div {
    margin-bottom: 0.5rem;
  }
  /* DRONE CONTROL PANEL */
  #drone-control {
    margin-top: 1rem;
    border-top: 1px solid #2d8c99;
    padding-top: 1rem;
  }
  #drone-visual {
    margin: 1rem auto 0;
    width: 280px;
    height: 280px;
    border: 3px solid #2d8c99;
    border-radius: 20px;
    background: #def9f1;
    position: relative;
    perspective: 800px;
  }
  /* Drone model (a box) */
  #drone-model {
    position: absolute;
    width: 60px;
    height: 20px;
    background: #2d8c99;
    border-radius: 8px;
    top: 50%;
    left: 50%;
    margin-left: -30px;
    margin-top: -10px;
    box-shadow: 0 0 15px #4db6ac;
    transform-style: preserve-3d;
    transition: transform 0.3s ease;
  }
  /* Control buttons grid */
  .btn-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.6rem;
    justify-items: center;
  }
  /* Center big start/land buttons */
  .btn-wide {
    grid-column: span 3;
    background-color: #f56c42;
    font-weight: 700;
  }
  .btn-wide:hover {
    background-color: #c14424;
  }
  /* Status text */
  #drone-status {
    margin-top: 1rem;
    font-weight: 600;
    color: #186a75;
    min-height: 1.3rem;
    text-align: center;
  }
  /* Responsive tweaks */
  @media (max-width: 400px) {
    .container {
      width: 95vw;
      padding: 1.5rem 1.5rem 2rem;
    }
    #drone-visual {
      width: 90vw;
      height: 90vw;
      max-width: 280px;
      max-height: 280px;
    }
  }
</style>
</head>
<body>

<div class="container">

  <!-- LOGIN SCREEN -->
  <section id="login-screen" class="screen active" aria-label="Ekran logowania">
    <h1>Logowanie</h1>
    <form id="login-form" novalidate>
      <div class="form-group">
        <label for="login-email">Email</label>
        <input type="email" id="login-email" name="login-email" autocomplete="username" required />
        <div id="login-email-error" class="error-msg" aria-live="polite"></div>
      </div>
      <div class="form-group">
        <label for="login-password">Hasło</label>
        <input type="password" id="login-password" name="login-password" autocomplete="current-password" required minlength="6" />
        <div id="login-password-error" class="error-msg" aria-live="polite"></div>
      </div>
      <button type="submit">Zaloguj się</button>
    </form>
    <div>
      <span>Nie masz konta? </span><span id="go-register" class="switch-link">Zarejestruj się</span>
    </div>
  </section>

  <!-- REGISTER SCREEN -->
  <section id="register-screen" class="screen" aria-label="Ekran rejestracji">
    <h1>Rejestracja</h1>
    <form id="register-form" novalidate>
      <div class="form-group">
        <label for="reg-name">Imię i nazwisko</label>
        <input type="text" id="reg-name" name="reg-name" required minlength="3" />
        <div id="reg-name-error" class="error-msg" aria-live="polite"></div>
      </div>
      <div class="form-group">
        <label for="reg-email">Email</label>
        <input type="email" id="reg-email" name="reg-email" autocomplete="email" required />
        <div id="reg-email-error" class="error-msg" aria-live="polite"></div>
      </div>
      <div class="form-group">
        <label for="reg-password">Hasło</label>
        <input type="password" id="reg-password" name="reg-password" required minlength="6" />
        <div id="reg-password-error" class="error-msg" aria-live="polite"></div>
      </div>
      <div class="form-group">
        <label for="reg-password-confirm">Powtórz hasło</label>
        <input type="password" id="reg-password-confirm" name="reg-password-confirm" required minlength="6" />
        <div id="reg-password-confirm-error" class="error-msg" aria-live="polite"></div>
      </div>
      <button type="submit">Zarejestruj się</button>
    </form>
    <div>
      <span>Masz już konto? </span><span id="go-login" class="switch-link">Zaloguj się</span>
    </div>
  </section>

  <!-- DASHBOARD SCREEN -->
  <section id="dashboard-screen" class="screen" aria-label="Panel użytkownika">
    <h1>Panel użytkownika</h1>
    <div id="dashboard-info">
      <div><strong>Użytkownik:</strong> <span id="dashboard-username"></span></div>
      <div><strong>Email:</strong> <span id="dashboard-email"></span></div>
      <div><strong>Zarejestrowany:</strong> <span id="dashboard-date"></span></div>
    </div>
    <button id="logout-btn">Wyloguj się</button>

    <section id="drone-control">
      <h2>Sterowanie dronem</h2>
      <div id="drone-visual" aria-label="Wizualizacja drona">
        <div id="drone-model" role="img" aria-label="Model drona"></div>
      </div>
      <div class="btn-grid" role="group" aria-label="Panel sterowania dronem">
        <button id="btn-up" aria-label="Góra">↑</button>
        <button id="btn-forward" aria-label="Przód">⇧</button>
        <button id="btn-rotate-left" aria-label="Obrót w lewo">⟲</button>

        <button id="btn-left" aria-label="Lewo">←</button>
        <button id="btn-start" class="btn-wide" aria-label="Start drona">Start</button>
        <button id="btn-right" aria-label="Prawo">→</button>

        <button id="btn-down" aria-label="Dół">↓</button>
        <button id="btn-backward" aria-label="Tył">⇩</button>
        <button id="btn-rotate-right" aria-label="Obrót w prawo">⟳</button>
      </div>
      <div id="drone-status" aria-live="polite" aria-atomic="true"></div>
    </section>
  </section>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
  // ======= KONFIGURACJA FIREBASE =======
  const firebaseConfig = {
    apiKey: "AIzaSyAWXiBO5-woCCEqCBc2rfOIo1RhUUtevzU",
    authDomain: "jaguar-analityka.firebaseapp.com",
    databaseURL: "https://jaguar-analityka-default-rtdb.firebaseio.com",
    projectId: "jaguar-analityka",
    storageBucket: "jaguar-analityka.appspot.com",
    messagingSenderId: "797947184851",
    appId: "1:797947184851:web:0cc25ca0dd8b178f418c26",
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const database = firebase.database();

  // ======= ELEMENTY DOM =======
  const loginScreen = document.getElementById('login-screen');
  const registerScreen = document.getElementById('register-screen');
  const dashboardScreen = document.getElementById('dashboard-screen');

  // --- Formularze ---
  const loginForm = document.getElementById('login-form');
  const registerForm = document.getElementById('register-form');

  // --- Dashboard info ---
  const dashboardUsername = document.getElementById('dashboard-username');
  const dashboardEmail = document.getElementById('dashboard-email');
  const dashboardDate = document.getElementById('dashboard-date');

  // --- Przełączanie ekranów ---
  document.getElementById('go-register').addEventListener('click', () => showScreen(registerScreen));
  document.getElementById('go-login').addEventListener('click', () => showScreen(loginScreen));

  function showScreen(screen) {
    [loginScreen, registerScreen, dashboardScreen].forEach(s => s.classList.remove('active'));
    screen.classList.add('active');
  }

  // --- Czyszczenie błędów ---
  function clearAllErrors() {
    document.querySelectorAll('.error-msg').forEach(el => el.textContent = '');
  }

  // ======= LOGOWANIE =======
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    clearAllErrors();

    const email = loginForm['login-email'].value.trim();
    const password = loginForm['login-password'].value;

    let valid = true;
    if (!email) {
      document.getElementById('login-email-error').textContent = 'Email jest wymagany';
      valid = false;
    }
    if (!password) {
      document.getElementById('login-password-error').textContent = 'Hasło jest wymagane';
      valid = false;
    } else if (password.length < 6) {
      document.getElementById('login-password-error').textContent = 'Hasło musi mieć minimum 6 znaków';
      valid = false;
    }
    if (!valid) return;

    auth.signInWithEmailAndPassword(email, password)
      .then(userCredential => {
        loadUserData(userCredential.user.uid);
        loginForm.reset();
      })
      .catch(error => {
        alert(error.message || 'Błąd logowania');
      });
  });

  // ======= REJESTRACJA =======
  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    clearAllErrors();

    const name = registerForm['reg-name'].value.trim();
    const email = registerForm['reg-email'].value.trim();
    const password = registerForm['reg-password'].value;
    const passwordConfirm = registerForm['reg-password-confirm'].value;

    let valid = true;
    if (!name || name.length < 3) {
      document.getElementById('reg-name-error').textContent = 'Podaj poprawne imię i nazwisko (min. 3 znaki)';
      valid = false;
    }
    if (!email) {
      document.getElementById('reg-email-error').textContent = 'Email jest wymagany';
      valid = false;
    }
    if (!password || password.length < 6) {
      document.getElementById('reg-password-error').textContent = 'Hasło musi mieć minimum 6 znaków';
      valid = false;
    }
    if (password !== passwordConfirm) {
      document.getElementById('reg-password-confirm-error').textContent = 'Hasła muszą się zgadzać';
      valid = false;
    }
    if (!valid) return;

    auth.createUserWithEmailAndPassword(email, password)
      .then(userCredential => {
        const userId = userCredential.user.uid;
        const regDate = new Date().toISOString();
        return database.ref('users/' + userId).set({
          name: name,
          email: email,
          registeredAt: regDate
        });
      })
      .then(() => {
        alert('Rejestracja udana! Możesz się teraz zalogować.');
        showScreen(loginScreen);
        registerForm.reset();
      })
      .catch(error => {
        alert(error.message || 'Błąd rejestracji');
      });
  });

  // ======= ZAŁADOWANIE DANYCH UŻYTKOWNIKA DO DASHBOARDU =======
  function loadUserData(uid) {
    database.ref('users/' + uid).once('value')
      .then(snapshot => {
        const data = snapshot.val();
        if (!data) throw new Error('Brak danych użytkownika w bazie');
        dashboardUsername.textContent = data.name || 'Użytkownik';
        dashboardEmail.textContent = data.email || '';
        dashboardDate.textContent = data.registeredAt ? (new Date(data.registeredAt)).toLocaleString() : 'Brak danych';
        showScreen(dashboardScreen);
        droneController.reset();
      })
      .catch(() => {
        alert('Nie udało się wczytać danych użytkownika');
        auth.signOut();
        showScreen(loginScreen);
      });
  }

  // ======= WYLOGOWANIE =======
  document.getElementById('logout-btn').addEventListener('click', () => {
    auth.signOut()
      .then(() => {
        alert('Wylogowano pomyślnie');
        showScreen(loginScreen);
      })
      .catch(() => {
        alert('Błąd podczas wylogowania');
      });
  });

  // ======= OBSŁUGA STANU ZALOGOWANIA =======
  auth.onAuthStateChanged(user => {
    if (user) {
      loadUserData(user.uid);
    } else {
      showScreen(loginScreen);
    }
  });

  // ======= STEROWANIE DRONEM =======
  const droneModel = document.getElementById('drone-model');
  const droneStatus = document.getElementById('drone-status');

  const droneController = {
    posX: 0,    // pozycja X (w px, względem centrum wizualizacji)
    posY: 0,    // pozycja Y (w px)
    posZ: 0,    // wysokość (prosta symulacja)
    rotY: 0,    // rotacja wokół osi Y (obrót lewo/prawo, stopnie)
    flying: false,

    maxMove: 80,    // max przesunięcie w px
    maxHeight: 100, // max wysokość

    updateVisual() {
      // Przesuwamy drona i obracamy
      droneModel.style.transform = `
        translate3d(${this.posX}px, ${-this.posZ}px, 0)
        rotateY(${this.rotY}deg)
      `;
    },

    reset() {
      this.posX = 0;
      this.posY = 0;
      this.posZ = 0;
      this.rotY = 0;
      this.flying = false;
      this.updateVisual();
      droneStatus.textContent = 'Dron jest wyłączony';
    },

    start() {
      if (this.flying) {
        droneStatus.textContent = 'Dron już lata!';
        return;
      }
      this.flying = true;
      this.posZ = 20;
      this.updateVisual();
      droneStatus.textContent = 'Dron wystartował!';
    },

    land() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron jest już na ziemi.';
        return;
      }
      this.flying = false;
      this.posZ = 0;
      this.updateVisual();
      droneStatus.textContent = 'Dron wylądował.';
    },

    moveForward() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      // Ruch w kierunku rotacji drona
      this.posX += step * Math.sin(this.rotY * Math.PI/180);
      this.posY += step * Math.cos(this.rotY * Math.PI/180);
      this.clampPosition();
      this.updateVisual();
      droneStatus.textContent = 'Dron leci do przodu.';
    },

    moveBackward() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      this.posX -= step * Math.sin(this.rotY * Math.PI/180);
      this.posY -= step * Math.cos(this.rotY * Math.PI/180);
      this.clampPosition();
      this.updateVisual();
      droneStatus.textContent = 'Dron leci do tyłu.';
    },

    moveLeft() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      // Ruch w lewo względem rotacji
      this.posX -= step * Math.cos(this.rotY * Math.PI/180);
      this.posY += step * Math.sin(this.rotY * Math.PI/180);
      this.clampPosition();
      this.updateVisual();
      droneStatus.textContent = 'Dron leci w lewo.';
    },

    moveRight() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      this.posX += step * Math.cos(this.rotY * Math.PI/180);
      this.posY -= step * Math.sin(this.rotY * Math.PI/180);
      this.clampPosition();
      this.updateVisual();
      droneStatus.textContent = 'Dron leci w prawo.';
    },

    moveUp() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      this.posZ += step;
      if (this.posZ > this.maxHeight) this.posZ = this.maxHeight;
      this.updateVisual();
      droneStatus.textContent = 'Dron leci w górę.';
    },

    moveDown() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się ruszać.';
        return;
      }
      const step = 10;
      this.posZ -= step;
      if (this.posZ < 0) this.posZ = 0;
      this.updateVisual();
      droneStatus.textContent = 'Dron leci w dół.';
    },

    rotateLeft() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się obracać.';
        return;
      }
      this.rotY -= 15;
      this.updateVisual();
      droneStatus.textContent = 'Dron obraca się w lewo.';
    },

    rotateRight() {
      if (!this.flying) {
        droneStatus.textContent = 'Dron musi wystartować, aby się obracać.';
        return;
      }
      this.rotY += 15;
      this.updateVisual();
      droneStatus.textContent = 'Dron obraca się w prawo.';
    },

    clampPosition() {
      if (this.posX > this.maxMove) this.posX = this.maxMove;
      if (this.posX < -this.maxMove) this.posX = -this.maxMove;
      if (this.posY > this.maxMove) this.posY = this.maxMove;
      if (this.posY < -this.maxMove) this.posY = -this.maxMove;
    }
  };

  // Przypisanie eventów do przycisków
  document.getElementById('btn-start').addEventListener('click', () => droneController.start());
  document.getElementById('btn-up').addEventListener('click', () => droneController.moveUp());
  document.getElementById('btn-down').addEventListener('click', () => droneController.moveDown());
  document.getElementById('btn-forward').addEventListener('click', () => droneController.moveForward());
  document.getElementById('btn-backward').addEventListener('click', () => droneController.moveBackward());
  document.getElementById('btn-left').addEventListener('click', () => droneController.moveLeft());
  document.getElementById('btn-right').addEventListener('click', () => droneController.moveRight());
  document.getElementById('btn-rotate-left').addEventListener('click', () => droneController.rotateLeft());
  document.getElementById('btn-rotate-right').addEventListener('click', () => droneController.rotateRight());

  // Możemy dodać również "lądowanie" na podwójny klik starta:
  document.getElementById('btn-start').addEventListener('dblclick', () => droneController.land());

  // Reset przy uruchomieniu strony
  droneController.reset();
</script>

</body>
</html>
import React, { useState, useEffect } from "react";
import firebase from "firebase/compat/app";
import "firebase/compat/auth";
import "firebase/compat/database";

// Konfiguracja Firebase - Twoje dane
const firebaseConfig = {
  apiKey: "AIzaSyAWXiBO5-woCCEqCBc2rfOIo1RhUUtevzU",
  authDomain: "jaguar-analityka.firebaseapp.com",
  databaseURL: "https://jaguar-analityka-default-rtdb.firebaseio.com",
  projectId: "jaguar-analityka",
  storageBucket: "jaguar-analityka.appspot.com",
  messagingSenderId: "797947184851",
  appId: "1:797947184851:web:0cc25ca0dd8b178f418c26",
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.database();

function App() {
  // Użytkownik i stan aplikacji
  const [user, setUser] = useState(null);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  
  // Drużyny
  const [teams, setTeams] = useState({});
  const [newTeamName, setNewTeamName] = useState("");
  const [newTeamDesc, setNewTeamDesc] = useState("");

  // Sterowanie dronem
  const [droneCommand, setDroneCommand] = useState("");

  // Autoryzacja - obserwator
  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged(u => {
      setUser(u);
      if (u) {
        loadTeams();
      } else {
        setTeams({});
      }
    });
    return () => unsubscribe();
  }, []);

  // Logowanie
  const handleLogin = async () => {
    setError("");
    try {
      await auth.signInWithEmailAndPassword(email, password);
    } catch (e) {
      setError(e.message);
    }
  };

  // Rejestracja
  const handleRegister = async () => {
    setError("");
    try {
      await auth.createUserWithEmailAndPassword(email, password);
    } catch (e) {
      setError(e.message);
    }
  };

  // Wylogowanie
  const handleLogout = async () => {
    await auth.signOut();
    setTeams({});
  };

  // Ładowanie drużyn z bazy
  const loadTeams = () => {
    const teamsRef = db.ref("teams");
    teamsRef.on("value", snapshot => {
      const data = snapshot.val() || {};
      setTeams(data);
    });
  };

  // Dodawanie nowej drużyny
  const addTeam = () => {
    if (!newTeamName) return alert("Podaj nazwę drużyny");
    const teamId = db.ref().child("teams").push().key;
    const teamData = {
      name: newTeamName,
      description: newTeamDesc,
      owner: user.uid,
      members: {
        [user.uid]: user.email,
      },
      createdAt: Date.now(),
    };
    const updates = {};
    updates[`teams/${teamId}`] = teamData;

    db.ref().update(updates);
    setNewTeamName("");
    setNewTeamDesc("");
  };

  // Dodawanie użytkownika do drużyny
  const addMemberToTeam = (teamId, memberEmail) => {
    if (!memberEmail) return alert("Podaj email członka");
    // Znajdź użytkownika po emailu
    auth.fetchSignInMethodsForEmail(memberEmail).then(methods => {
      if (methods.length === 0) {
        alert("Użytkownik nie istnieje");
        return;
      }
      // Dodaj do drużyny w bazie
      const memberRef = db.ref(`teams/${teamId}/members`);
      memberRef.update({ [memberEmail.replace(/\./g, ",")]: memberEmail });
    });
  };

  // Sterowanie dronem (prosty przykład - zapisujemy komendy do bazy)
  const sendDroneCommand = (command) => {
    setDroneCommand(command);
    db.ref(`drone/commands`).set({
      command,
      timestamp: Date.now(),
      user: user.uid,
    });
  };

  // Renderowanie UI
  if (!user) {
    // Ekran logowania/rejestracji
    return (
      <div style={{ padding: 20, fontFamily: "Arial" }}>
        <h1>Logowanie / Rejestracja</h1>
        <input
          type="email"
          placeholder="Email"
          value={email}
          onChange={e => setEmail(e.target.value)}
          style={{ padding: 8, marginBottom: 10, width: "300px" }}
        />
        <br />
        <input
          type="password"
          placeholder="Hasło"
          value={password}
          onChange={e => setPassword(e.target.value)}
          style={{ padding: 8, marginBottom: 10, width: "300px" }}
        />
        <br />
        <button onClick={handleLogin} style={{ marginRight: 10, padding: "8px 20px" }}>Zaloguj się</button>
        <button onClick={handleRegister} style={{ padding: "8px 20px" }}>Zarejestruj się</button>
        {error && <p style={{ color: "red" }}>{error}</p>}
      </div>
    );
  }

  return (
    <div style={{ padding: 20, fontFamily: "Arial" }}>
      <h1>Witaj, {user.email}</h1>
      <button onClick={handleLogout} style={{ marginBottom: 20, padding: "8px 20px" }}>
        Wyloguj się
      </button>

      <section style={{ marginBottom: 30 }}>
        <h2>Dodaj drużynę</h2>
        <input
          placeholder="Nazwa drużyny"
          value={newTeamName}
          onChange={e => setNewTeamName(e.target.value)}
          style={{ padding: 8, width: 300, marginRight: 10 }}
        />
        <input
          placeholder="Opis drużyny"
          value={newTeamDesc}
          onChange={e => setNewTeamDesc(e.target.value)}
          style={{ padding: 8, width: 300, marginRight: 10 }}
        />
        <button onClick={addTeam} style={{ padding: "8px 20px" }}>Dodaj</button>
      </section>

      <section style={{ marginBottom: 30 }}>
        <h2>Twoje drużyny</h2>
        {Object.keys(teams).length === 0 && <p>Nie masz jeszcze żadnych drużyn.</p>}
        <ul>
          {Object.entries(teams).map(([teamId, team]) => (
            <li key={teamId} style={{ marginBottom: 15, border: "1px solid #ccc", padding: 10 }}>
              <h3>{team.name}</h3>
              <p>{team.description}</p>
              <p>Właściciel: {team.owner === user.uid ? "Ty" : team.owner}</p>
              <strong>Członkowie:</strong>
              <ul>
                {team.members && Object.entries(team.members).map(([memberId, memberEmail]) => (
                  <li key={memberId}>{memberEmail}</li>
                ))}
              </ul>
              {/* Dodawanie członka */}
              <AddMemberForm teamId={teamId} />
            </li>
          ))}
        </ul>
      </section>

      <section>
        <h2>Sterowanie dronem</h2>
        <p>Ostatnia komenda: <b>{droneCommand}</b></p>
        <button onClick={() => sendDroneCommand("start")} style={{ marginRight: 10, padding: "8px 20px" }}>Start</button>
        <button onClick={() => sendDroneCommand("stop")} style={{ marginRight: 10, padding: "8px 20px" }}>Stop</button>
        <button onClick={() => sendDroneCommand("left")} style={{ marginRight: 10, padding: "8px 20px" }}>Lewo</button>
        <button onClick={() => sendDroneCommand("right")} style={{ marginRight: 10, padding: "8px 20px" }}>Prawo</button>
        <button onClick={() => sendDroneCommand("forward")} style={{ marginRight: 10, padding: "8px 20px" }}>Do przodu</button>
        <button onClick={() => sendDroneCommand("backward")} style={{ padding: "8px 20px" }}>Do tyłu</button>
      </section>
    </div>
  );
}

function AddMemberForm({ teamId }) {
  const [email, setEmail] = useState("");

  const handleAddMember = () => {
    if (!email) return alert("Podaj email członka");
    // Zamiana kropki na przecinek, bo Firebase nie lubi kluczy z kropkami
    const safeEmailKey = email.replace(/\./g, ",");
    const memberRef = firebase.database().ref(`teams/${teamId}/members`);
    memberRef.update({ [safeEmailKey]: email });
    setEmail("");
  };

  return (
    <div style={{ marginTop: 10 }}>
      <input
        placeholder="Email nowego członka"
        value={email}
        onChange={e => setEmail(e.target.value)}
        style={{ padding: 6, width: 250, marginRight: 8 }}
      />
      <button onClick={handleAddMember} style={{ padding: "6px 12px" }}>Dodaj członka</button>
    </div>
  );
}

export default App;
